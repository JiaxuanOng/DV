<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Movie/TV Show Rating Distribution</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>
  <body>
    <h2>Movie/TV Show Rating Distribution</h2>
    <div>
      <label for="platform">Platform:</label>
      <input type="radio" id="platformAmazon" name="platform" value="amazon" checked />
      <label for="platformAmazon">Amazon</label>
      <input type="radio" id="platformNetflix" name="platform" value="netflix" />
      <label for="platformNetflix">Netflix</label>
      <!-- Add more platform options if needed -->

      <br />

      <label for="type">Type:</label>
      <input type="radio" id="typeMovie" name="type" value="Movie" checked />
      <label for="typeMovie">Movie</label>
      <input type="radio" id="typeTV" name="type" value="TV Show" />
      <label for="typeTV">TV Show</label>
      <!-- Add more type options if needed -->
    </div>

    <div id="chart"></div>

    <script>
      // Function to update the chart based on selected platform and type
      // Function to update the chart based on selected platform and type
function updateChart(data) {
  const selectedPlatform = document.querySelector('input[name="platform"]:checked').value;
  const selectedType = document.querySelector('input[name="type"]:checked').value;

  // Filter the data based on selected platform and type
  const filteredData = data.filter((d) => d.platform === selectedPlatform && d.type === selectedType);

  // Calculate ratings for non-repeated titles
  const uniqueTitles = {};
  filteredData.forEach((d) => {
    const key = d.title.toLowerCase();
    if (!uniqueTitles[key]) {
      uniqueTitles[key] = d.rating;
    }
  });

  // Count the ratings
  const ratingCounts = {};
  Object.values(uniqueTitles).forEach((rating) => {
    if (ratingCounts[rating]) {
      ratingCounts[rating]++;
    } else {
      ratingCounts[rating] = 1;
    }
  });

  // Prepare data for the chart
  const chartData = Object.entries(ratingCounts).map(([rating, count]) => ({
    rating,
    count,
  }));

  // Clear existing chart
  d3.select("#chart").html("");

  // Set up chart dimensions
  const margin = { top: 20, right: 20, bottom: 30, left: 60 };
  const width = 800 - margin.left - margin.right;
  const height = 400 - margin.top - margin.bottom;

  // Create SVG element
  const svg = d3
    .select("#chart")
    .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

  // Define scales
  const xScale = d3
    .scaleBand()
    .range([0, width])
    .domain(chartData.map((d) => d.rating))
    .padding(0.2);

  const yScale = d3.scaleLinear().range([height, 0]).domain([0, d3.max(chartData, (d) => d.count)]);

  // Draw bars
  svg
    .selectAll(".bar")
    .data(chartData)
    .enter()
    .append("rect")
    .attr("class", "bar")
    .attr("x", (d) => xScale(d.rating))
    .attr("width", xScale.bandwidth())
    .attr("y", (d) => yScale(d.count))
    .attr("height", (d) => height - yScale(d.count))
    .attr("fill", "steelblue");

  // Add x-axis
  svg
    .append("g")
    .attr("transform", `translate(0, ${height})`)
    .call(d3.axisBottom(xScale))
    .selectAll("text")
    .style("text-anchor", "end")
    .attr("dx", "-.8em")
    .attr("dy", ".15em")
    .attr("transform", "rotate(-45)");

  // Add y-axis
  svg.append("g").call(d3.axisLeft(yScale));
}

// Attach event listeners to radio buttons
const platformRadios = document.querySelectorAll('input[name="platform"]');
platformRadios.forEach((radio) => radio.addEventListener("change", loadData));

const typeRadios = document.querySelectorAll('input[name="type"]');
typeRadios.forEach((radio) => radio.addEventListener("change", loadData));

// Load data from CSV file
function loadData() {
  const selectedPlatform = document.querySelector('input[name="platform"]:checked').value;
  const selectedType = document.querySelector('input[name="type"]:checked').value;

  d3.csv("StreamingPlatform.csv").then((data) => {
    // Filter data based on platform and type
    const filteredData = data.filter((d) => d.platform === selectedPlatform && d.type === selectedType);

    // Call updateChart with the filtered data
    updateChart(filteredData);
  });
}

// Initial chart rendering
loadData();

    </script>
  </body>
</html>
